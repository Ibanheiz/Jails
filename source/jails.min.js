define(function(){var t,n,e,i,a={};i=Array.prototype.slice,t={config:{templates:{type:"x-tmpl-mustache"}},context:null,start:function(i,a){n=i.base,t.context=n(document.documentElement),e=n("<i />"),n.extend(!0,t.config,i),r.start(a),t.context.addClass("ready")},refresh:function(t){r.start(t)},data:function(){return a}};var r={start:function(n){var e,i=[];n=n||t.context,e=t.config.templates.type,r.scan("partial","script[type="+e+"]",n,i),r.scan("component","[data-component]",n,i),r.scan("view","[data-view]",n,i),r.scan("controller","[data-controller]",n,i),r.scan("app","[data-app]",n,i),s.start(i)},scan:function(e,i,a,s){a=a||t.context;var o,c,l,u;c=a.get(0).querySelectorAll(i),l=c.length;for(var f=0;l>f;f++)o=n(c[f]),u=r[e],u?u(e,o,s):r.module(e,o,s)},module:function(n,e,i){var r,o,c="s";r=e.data(n),o=t[n+c][r],o=o?new o(e,a):new s[n]._class(r,e,n),i.push(o)},partial:function(e,i){var a=t.config.templates.prefix,r=i.prop("id").split(a||"tmpl-").pop();t.templates[r]=n.trim(i.html())},component:function(e,i,a){var r,o,c,l,u,f={};r=i.data(e),o=r.replace(/\s/g,"").split(/\,/),l=i.get(0).previousSibling,l=l?l.previousSibling:null,l&&8==l.nodeType&&(u=l.data.replace(/\@(.*)\((\{.*\})\)/g,function(t,n,e){f[n]=new Function("return "+e)()})),n.each(o,function(n,r){c=t.components[r],c=c?new c(i,r in f?f[r]:{}):new s[e]._class(r,i),a.push(c)})}},s={start:function(t){for(var n=t.length,e=0;n>e;e++)t[e].init&&t[e].init();t=null},common:{_class:function(t,a){var r,s=this;this.name=t,r=a.get(0),a.on("execute",function(n,e){var i=e.args.shift(),a=s[i];a?a.apply(s,e.args):console.error("Jails.error::",t,"has no method :",i),n.stopPropagation()}),this.x=function(t){return t=n(r.querySelector(t)),function(){var n=i.call(arguments);t.trigger("execute",{args:n})}},this.broadcast=function(t,e){var a=i.call(arguments);a.shift(),a.shift(),n(r.querySelector(t)).trigger(e,{args:a})},this.listen=function(t,n){a.on(t,function(t,e){n.apply(e.element,[t].concat(e.args))})},this.emit=function(n,e){e=i.call(arguments),e.shift(),a.trigger(t+":"+n,{args:e,element:a.get(0)})},this.publish=function(t,n){n=i.call(arguments),n.shift(),e.trigger(t,{args:n,element:a.get(0)})},this.subscribe=function(t,n){e.on(t,function(t,e){n.apply(e.element,[t].concat(e.args))})}}},app:{_class:function(t,n){s.common._class.apply(this,[t,n])}},controller:{_class:function(t,n){s.common._class.apply(this,[t,n])}},view:{_class:function(e,i){function o(t){return t?f[t]:null}function c(t){var e=t.html(),i=n("<div />"),a=n("<div />");return a.append(e),a.find("[data-if]").each(function(){var t=n(this),e=t.data("if");t.before("{{#"+e+"}}"),t.after("{{/"+e+"}}")}),a.find("[data-not]").each(function(){var t=n(this),e=t.data("not");t.before("{{^"+e+"}}"),t.after("{{/"+e+"}}")}),a.find("[data-each]").each(function(){var t=n(this),e=t.children().eq(0),a=t.data("each");i.empty().append(e),t.html("{{#"+a+"}}"+i.html()+"{{/"+a+"}}")}),a.find("[data-value]").each(function(){var t=n(this),e=t.data("value"),i=e.split(/\:/);t.html(i[1]?"{{#"+i[1]+"}}{{"+i[0]+"}}{{/"+i[1]+"}}":"{{"+e+"}}")}),a.find("[data-out]").each(function(){n(this).before("{{#out}}").after("{{/out}}")}),n.trim(a.html().replace(/(data-attr)=["']?((?:.(?!["']?\s+(?:\S+)=|[>"']))+.)["']?/g,function(t,n,e){return e}))}s.common._class.apply(this,[e,i]);var l,u,f,h,p=this;u=t.config.templates,f=t.templates,l=o(i.data("template"))||c(i),h=i.data("render"),this.watch=function(t,n,e){i.on(n,t,e)},this.template=function(t,n){return u.engine.render(o(n),t,f)},this.render=function(t,n){var e=n||l;this.partial(i,e,t)},this.partial=function(e,i,a){var s,o;a=a||{},i=f[i]||i,a&&a.done?a.done(function(t){p.partial(e,i,t)}):(s=n.extend({},a,t.filters),o=u.engine.render(i||l,s,f),e.html(o),r.start(e))},h?this.render(a):null}},model:{_class:function(t){var e={};this.name=t,this.data=function(t,i){return t?(e=t,i&&(e=this.transform(i,t)),n?n(this).trigger("change",e):null,void 0):e},this.on=function(t,e){n(this).on(t,function(t,n){e.call(this,n)})},this.trigger=function(t,e){n(this).trigger(t,e)},this.find=function(t){return e[t]},this.remove=function(t){delete e[t],this.trigger("change",e)},this.update=function(t,n){e[t]=n,this.trigger("change",e)},this.to_array=function(){return n.map(e,function(t){return[t]})},this.transform=function(t,n){n=n||e,n=n.push?n:[n];var i,a,r={},s=n.length;for(i=0;s>i;i++)a=n[i],r[a[t||i]]=a;return count=i,r}}},component:{_class:function(t,n){this.name=t,this.emit=function(e,a){a=i.call(arguments),a.shift(),n.trigger(t+":"+e,{args:a,element:n.get(0)})},this.listen=function(t,e){n.on(t,function(t,n){e.apply(n.element,[t].concat(n.args))})}}}},o={_class:function(){function e(n,e,i){return this instanceof t[n]?void s[n]._class.call(this,arguments[2],arguments[1]):this[n+"s"][e]=function(t,a){s[n]._class.call(this,e,t),i.call(this,t,a)}}this.apps={},this.controllers={},this.views={},this.models={},this.components={},this.templates={},this.filters={},this.controller=function(t,n){return e.call(this,"controller",t,n)},this.component=function(t,n){e.call(this,"component",t,n)},this.view=function(t,n){e.call(this,"view",t,n)},this.app=function(t,n){e.call(this,"app",t,n)},this.filter=function(t,n){this.filters[t]=function(){return function(t,e){return n(e(t))}}},this.model=function(n,e){if(!(this instanceof t.model)){t.models[n]=e;var i=new s.model._class(n);return e.apply(i),i}s.model._class.call(this,n)},this.filter("out",function(t){var e=n(t),i=n("<div />"),a=e.data("out");return e.html(new Function("return "+a)()),i.append(e),i.html()})}};return o._class.apply(t),t});
