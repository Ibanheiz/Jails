define(function(){var t,n,e,i={};t={config:{templates:{type:"x-tmpl-mustache"}},context:null,start:function(i,s){n=i.base,t.context=n(document.documentElement),e=n("<i />"),n.extend(!0,t.config,i),a.start(s),t.context.addClass("ready")},refresh:function(t){a.start(t)},data:function(){return i}};var a={start:function(n){var e,i=[];n=n||t.context,e=t.config.templates.type,a.scan("partial","script[type="+e+"]",n,i),a.scan("component","[data-component]",n,i),a.scan("view","[data-view]",n,i),a.scan("controller","[data-controller]",n,i),a.scan("app","[data-app]",n,i),s.start(i)},scan:function(e,i,s,r){s=s||t.context;var o,c,l,u;c=s.get(0).querySelectorAll(i),l=c.length;for(var f=0;l>f;f++)o=n(c[f]),u=a[e],u?u(e,o,r):a.module(e,o,r)},module:function(n,e,a){var r,o,c="s";r=e.data(n),o=t[n+c][r],o=o?new o(e,i):new s[n]._class(r,e,n),a.push(o)},partial:function(e,i){var a=t.config.templates.prefix,s=i.prop("id").split(a||"tmpl-").pop();t.templates[s]=n.trim(i.html())},component:function(e,i,a){var r,o,c,l,u,f={};r=i.data(e),o=r.replace(/\s/g,"").split(/\,/),l=i.get(0).previousSibling.previousSibling,l&&8==l.nodeType&&(u=l.data.replace(/\@(.*)\((\{.*\})\)/g,function(t,n,e){f[n]=new Function("return "+e)()})),n.each(o,function(n,r){c=t.components[r],c=c?new c(i,r in f?f[r]:{}):new s[e]._class(r,i),a.push(c)})}},s={start:function(t){for(var n=t.length,e=0;n>e;e++)t[e].init&&t[e].init();t=null},common:{_class:function(t,n){this.name=t,this.broadcast=function(t,e){var i,a,s=t.split(/\:/);i=s[0],a=s[1],n.find("[data-"+i+"]").trigger(a,e)},this.listen=function(t,e){n.on(t,function(t,n){e.apply(n.element,[t].concat(n.args))})},this.emit=function(e,i){i=Array.prototype.slice.call(arguments),i.shift(),n.trigger(t+":"+e,{args:i,element:n.get(0)})},this.publish=function(t,i){i=Array.prototype.slice.call(arguments),i.shift(),e.trigger(t,{args:i,element:n.get(0)})},this.subscribe=function(t,n){e.on(t,function(t,e){n.apply(e.element,[t].concat(e.args))})}}},app:{_class:function(t,n){s.common._class.apply(this,[t,n])}},controller:{_class:function(t,n){s.common._class.apply(this,[t,n])}},view:{_class:function(e,r){function o(t){return t?f[t]:null}function c(t){var e=t.html(),i=n("<div />"),a=n("<div />");return a.append(e),a.find("[data-if]").each(function(){var t=n(this),e=t.data("if");t.before("{{#"+e+"}}"),t.after("{{/"+e+"}}")}),a.find("[data-not]").each(function(){var t=n(this),e=t.data("not");t.before("{{^"+e+"}}"),t.after("{{/"+e+"}}")}),a.find("[data-each]").each(function(){var t=n(this),e=t.children().eq(0),a=t.data("each");i.empty().append(e),t.html("{{#"+a+"}}"+i.html()+"{{/"+a+"}}")}),a.find("[data-value]").each(function(){var t=n(this),e=t.data("value"),i=e.split(/\:/);t.html(i[1]?"{{#"+i[1]+"}}{{"+i[0]+"}}{{/"+i[1]+"}}":"{{"+e+"}}")}),a.find("[data-out]").each(function(){n(this).before("{{#out}}").after("{{/out}}")}),n.trim(a.html().replace(/(data-attr)=["']?((?:.(?!["']?\s+(?:\S+)=|[>"']))+.)["']?/g,function(t,n,e){return e}))}s.common._class.apply(this,[e,r]);var l,u,f,h,p=this;u=t.config.templates,f=t.templates,l=o(r.data("template"))||c(r),h=r.data("render"),this.watch=function(t,n,e){r.on(n,t,e)},this.template=function(t,n){return u.engine.render(o(n),t,f)},this.render=function(t,n){var e=n||l;this.partial(r,e,t)},this.partial=function(e,i,s){var r,o;s=s||{},i=f[i]||i,s&&s.done?s.done(function(t){p.partial(e,i,t)}):(r=n.extend({},s,t.filters),o=u.engine.render(i||l,r,f),e.html(o),a.start(e))},h?this.render(i):null}},model:{_class:function(t){var e={};this.name=t,this.data=function(t,i){return t?(e=t,i&&(e=this.transform(i,t)),n?n(this).trigger("change",e):null,void 0):e},this.on=function(t,e){n(this).on(t,function(t,n){e.call(this,n)})},this.trigger=function(t,e){n(this).trigger(t,e)},this.find=function(t){return e[t]},this.remove=function(t){delete e[t],this.trigger("change",e)},this.update=function(t,n){e[t]=n,this.trigger("change",e)},this.to_array=function(){return n.map(e,function(t){return[t]})},this.transform=function(t,n){n=n||e,n=n.push?n:[n];var i,a,s={},r=n.length;for(i=0;r>i;i++)a=n[i],s[a[t||i]]=a;return count=i,s}}},component:{_class:function(t,n){this.name=t,this.emit=function(e,i){i=Array.prototype.slice.call(arguments),i.shift(),n.trigger(t+":"+e,{args:i,element:n.get(0)})},this.listen=function(t,e){n.on(t,function(t,n){e.apply(n.element,[t,n])})}}}},r={_class:function(){function e(n,e,i){return this instanceof t[n]?void s[n]._class.call(this,arguments[2],arguments[1]):this[n+"s"][e]=function(t,a){s[n]._class.call(this,e,t),i.call(this,t,a)}}this.apps={},this.controllers={},this.views={},this.models={},this.components={},this.templates={},this.filters={},this.controller=function(t,n){return e.call(this,"controller",t,n)},this.component=function(t,n){e.call(this,"component",t,n)},this.view=function(t,n){e.call(this,"view",t,n)},this.app=function(t,n){e.call(this,"app",t,n)},this.filter=function(t,n){this.filters[t]=function(){return function(t,e){return n(e(t))}}},this.model=function(n,e){if(!(this instanceof t.model)){t.models[n]=e;var i=new s.model._class(n);return e.apply(i),i}s.model._class.call(this,n)},this.filter("out",function(t){var e=n(t),i=n("<div />"),a=e.data("out");return e.html(new Function("return "+a)()),i.append(e),i.html()})}};return r._class.apply(t),t});
