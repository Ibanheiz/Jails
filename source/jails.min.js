define(function(){function i(e){function t(e){var t;e.trigger("get-instance",function(e){t=e});return t||{}}return{execute:function(n,r){r=Array.prototype.slice.call(arguments);r.shift();var i=t(e.eq(0));if(i[n])i[n].apply(i,r)},broadcast:function(n,r){r=Array.prototype.slice.call(arguments);r.shift();e.each(function(){var e=t($(this));if(e[n])e[n].apply(e,r)})},instance:function(){return t(e.eq(0))}}}var e,t;e={config:{},context:$(document.documentElement),start:function(e,t){n.start(e,t)}};var n={start:function(t,i){var s,o=[];$.extend(e.config,t);i=i||e.context;s=e.config.templates.type||"x-tmpl-mustache";n.scan("partial","script[type="+s+"]",i,o);n.scan("include","[data-include]",i,o);n.scan("component","[data-component]",i,o);n.scan("view","[data-view]",i,o);n.scan("controller","[data-controller]",i,o);n.scan("app","[data-app]",i,o);r.start(o)},scan:function(t,r,i,s){i=i||e.context;var o,u,a,f;u=i.get(0).querySelectorAll(r);a=u.length;for(var l=0;l<a;l++){o=$(u[l]);f=n[t];f?f(t,o,s):n.module(t,o,s)}},include:function(e,t,n){var r=t.data(e);$.get(r).done(function(e){t.replaceWith(e)})},module:function(t,n,i){var s,o,u,a="s";s=n.data(t);o=new r[t]._class(s,n,t);u=e[t+a][s];u?u.apply(o,[n]):null;i.push(o)},partial:function(t,n){var r=e.config.templates.prefix;var i=n.prop("id").split(r||"tmpl-").pop();e.templates[i]=$.trim(n.html())},component:function(t,n,i){var s,o,u,a;s=n.data(t);o=s.replace(/\s/g,"").split(/\,/);$.each(o,function(s,o){u=new r[t]._class(o,n);a=e.components[o];a?a.apply(u,[n]):null;i.push(u)})}};var r={start:function(e){var t=e.length;for(var n=0;n<t;n++)if(e[n].init)e[n].init();e=null},common:{_class:function(t,n){var r=this,s;this.name=t;n.on("get-instance",function(e,t){t(r);e.stopPropagation()});this.get=function(e,t){var r;if(t)r=n.find("[data-"+e+'*="'+t+'"]');else r=n.find("[data-"+e+"]");return i(r)};this.data=function(e){if(e){this.get("view").broadcast("render",e);s=e}else return s};this.watch=function(e,t,r){n.on(t,e,r)};this.broadcast=function(e,t){$(e).trigger(t)};this.listen=function(t,n){e.context.on(t,function(e,t){n.apply(t.element,t.args)})};this.emit=function(r,i){i=Array.prototype.slice.call(arguments);i.shift();e.context.trigger(t+":"+r,{args:i,element:n.get(0)})}}},app:{_class:function(e,t){r.common._class.apply(this,[e,t])}},controller:{_class:function(e,t){r.common._class.apply(this,[e,t])}},view:{_class:function(t,i){function f(e){return u[e]}r.common._class.apply(this,[t,i]);var s,o,u,a;s=i.data("template");a=i.data("render");o=e.config.templates;u=e.templates;this.template=function(e,t){return o.engine.render(f(t),e,u)};this.render=function(e,t){s=t||s;if(s&&u[s])this.partial(i,s,e)};this.partial=function(e,t,i){if(u[t]){var s=[];var a=o.engine.render(f(t),i,u);e.html(a);n.scan("component","[data-component]",e,s);n.scan("view","[data-view]",e,s);n.scan("controller","[data-controller]",e,s);r.start(s)}};a?this.render({}):null}},model:{_class:function(e,t){}},component:{_class:function(t,n){this.name=t;var r=this;n.on("get-instance",function(e,t){t(r);e.stopPropagation()});this.emit=function(r,i){i=Array.prototype.slice.call(arguments);i.shift();e.context.trigger(t+":"+r,{args:i,element:n.get(0)})}}}};var s={_class:function(){this.apps={};this.controllers={};this.views={};this.models={};this.components={};this.templates={};this.controller=function(e,t){this.controllers[e]=t},this.component=function(e,t){this.components[e]=t},this.view=function(e,t){this.views[e]=t},this.app=function(e,t){this.apps[e]=t},this.model=function(t,n){r.model._class.apply(n);e.models[t]=n;return n}}};s._class.apply(e);return e});
