define(function(){function t(t){return t.split(/\//).pop().split(/\./).shift()}var n,i,e,s,o={};s=Array.prototype.slice,n={config:{templates:{type:"x-tmpl-mustache"}},context:null,start:function(t,s){i=t.base,n.context=i(document.documentElement),e=i("<i />"),i.extend(!0,n.config,t),a.start(s),n.context.addClass("ready")},refresh:function(t){a.start(t)},data:function(){return o}};var a={start:function(t){var i,e=[];t=t||n.context,i=n.config.templates.type,a.scan("partial","script[type="+i+"]",t,e),a.scan("component","[data-component]",t,e),a.scan("controller","[data-controller]",t,e),a.scan("app","[data-app]",t,e),r.start(e)},scan:function(t,e,s,o){s=s||n.context;var r,c,l,u;c=s.get(0).querySelectorAll(e),l=c.length;for(var p=0;l>p;p++)r=i(c[p]),u=a[t],u?u(t,r,o):a.module(t,r,o)},module:function(t,i,e){var s,a,c="s";s=i.data(t),a=n[t+c][s],a=a?new a(i,o):new r[t]._class(s,i,t),e.push(a)},partial:function(t,e){var s=n.config.templates.prefix,o=e.prop("id").split(s||"tmpl-").pop();n.templates[o]=i.trim(e.html())},component:function(t,e,s){var o,c,l,u;o=e.data(t),u=a.annotations(o,e),c=o.replace(/\s/g,"").split(/\,/),i.each(c,function(i,o){l=n.components[o],l=l?new l(e,o in u?u[o]:{}):new r[t]._class(o,e),s.push(l)})},annotations:function(t,n){var i,e,s={};return i=n.get(0).previousSibling,i=i?i.previousSibling:null,i&&8==i.nodeType&&(e=i.data.replace(/[\n\s\t]/g,"").replace(/\@(\w*)\(([^@]*)\)/g,function(t,n,i){s[n]=new Function("return "+i)()})),s}},r={start:function(t){for(var n=t.length,i=0;n>i;i++)t[i].init&&t[i].init();t=null},common:{_class:function(t,n){var i=this;this.name=t,n.on("execute",function(n,e){var s=[].concat(e.args),o=s.shift(),a=i[o];a?a.apply(i,s):console.warn("Jails@warning =>",t,"has no method :",o),n.stopPropagation()})}},app:{_class:function(t,n){r.common._class.apply(this,[t,n]);var i=n.get(0);this.watch=function(t,i,e){n.on(i,t,e)},this.x=function(t){return t=n.find(t),function(){var n=s.call(arguments);t.trigger("execute",{args:n})}},this.listen=function(t,i){n.on(t,function(t,n){i.apply(n.element,[t].concat(n.args))})},this.emit=function(e,o){o=s.call(arguments),o.shift(),n.trigger(t+":"+e,{args:o,element:i})},this.publish=function(t,n){n=s.call(arguments),n.shift(),e.trigger(t,{args:n,element:i})},this.subscribe=function(t,n){e.on(t,function(t,i){n.apply(i.element,[t].concat(i.args))})}}},controller:{_class:function(t,n){r.app._class.apply(this,[t,n])}},model:{_class:function(t){var n={};this.name=t,this.data=function(t,e){return t?(n=t,e&&(n=this.transform(e,t)),i?i(this).trigger("change",n):null,void 0):n},this.on=function(t,n){i(this).on(t,function(t,i){n.call(this,i)})},this.trigger=function(t,n){i(this).trigger(t,n)},this.find=function(t){return n[t]},this.remove=function(t){delete n[t],this.trigger("change",n)},this.update=function(t,i){n[t]=i,this.trigger("change",n)},this.to_array=function(){return i.map(n,function(t){return[t]})},this.transform=function(t,i){i=i||n,i=i.push?i:[i];var e,s,o={},a=i.length;for(e=0;a>e;e++)s=i[e],o[s[t||e]]=s;return count=e,o}}},component:{_class:function(t,n){r.common._class.apply(this,[t,n]),this.emit=function(i,e){e=s.call(arguments),e.shift(),n.trigger(t+":"+i,{args:e,element:n.get(0)})},this.listen=function(t,i){n.on(t,function(t,n){i.apply(n.element,[t].concat(n.args))})}}}},c={_class:function(){function e(t,i,e){return this instanceof n[t]?void r[t]._class.call(this,arguments[2],arguments[1]):this[t+"s"][i]=function(n,s){r[t]._class.call(this,i,n),e.call(this,n,s)}}this.apps={},this.controllers={},this.models={},this.components={},this.templates={},this.filters={},this.template={promises:{},load:function(e,s){var o,a,r;return s=s||t(e),o=n.templates,a=o[s],pm=this.promises[s],a?a:pm?pm:(r=i.get(e).done(function(t){o[s]=t}),this.promises[s]=r,r)}},this.controller=function(t,n){return e.call(this,"controller",t,n)},this.component=function(t,n){e.call(this,"component",t,n)},this.app=function(t,n){e.call(this,"app",t,n)},this.filter=function(t,n){this.filters[t]=function(){return function(t,i){return n(i(t))}}},this.model=function(t,i){if(!(this instanceof n.model)){n.models[t]=i;var e=new r.model._class(t);return i.apply(e),e}r.model._class.call(this,t)},this.filter("out",function(t){var n=i(t),e=i("<div />"),s=n.data("out");return n.html(new Function("return "+s)()),e.append(n),e.html()})}};return c._class.apply(n),n});
