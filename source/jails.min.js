define(function(){function t(t){var e="component"!=t?"app":t;return function(a,o){this instanceof n[t]?c[e].call(this,arguments[2],arguments[1]):n[t+"s"][a]=function(t,n){c[e].call(this,a,t),o.call(this,t,n)}}}var n,e,a,o,r={};o=Array.prototype.slice,n={context:null,config:{templates:{type:"x-tmpl-mustache"}},apps:{},controllers:{},components:{},templates:{},filters:{},app:t("app"),controller:t("controller"),component:t("component"),filter:function(t,n){this.filters[t]=function(){return function(t,e){return n(e(t))}}},start:function(t,o){e=t.base,n.context=e(document.documentElement),a=e("<i />"),e.extend(!0,n.config,t),i.start(o),n.context.addClass("ready")},refresh:function(t){i.start(t)},data:function(){return r},scanner:function(){return i}},n.filters.out=function(t){var n=e(t),a=e("<div />"),o=n.data("out");return n.html(new Function("return "+o)()),a.append(n),a.html()};var i={start:function(t){var e,a=[];t=t||n.context,e=n.config.templates.type,i.scan("partial","script[type="+e+"]",t,a),i.scan("component","[data-component]",t,a),i.scan("controller","[data-controller]",t,a),i.scan("app","[data-app]",t,a),c.start(a)},scan:function(t,a,o,r){o=o||n.context;var c,s,l,u;s=o.get(0).querySelectorAll(a),l=s.length;for(var p=0;l>p;p++)c=e(s[p]),u=i[t],u?u(t,c,r):i.module(t,c,r)},module:function(t,e,a){var o,i,s="s";o=e.data(t),i=n[t+s][o],i=i?new i(e,r):new c[t](o,e,t),a.push(i)},partial:function(t,a){var o=n.config.templates.prefix,r=a.prop("id").split(o||"tmpl-").pop();n.templates[r]=e.trim(a.html())},component:function(t,a,o){var r,s,l,u;r=a.data(t),u=i.annotations(r,a),s=r.replace(/\s/g,"").split(/\,/),e.each(s,function(e,r){l=n.components[r],l=l?new l(a,r in u?u[r]:{}):new c[t](r,a),o.push(l)})},annotations:function(t,n){var e,a,o={};return e=n.get(0).previousSibling,e=e?e.previousSibling:null,e&&8==e.nodeType&&(a=e.data.replace(/[\n\t]/g,"").replace(/\@([a-zA-z0-9-]*)\(([^@]*)\)/g,function(t,n,e){o[n]=new Function("return "+e)()})),o}},c={start:function(t){for(var n=t.length,e=0;n>e;e++)t[e].init&&t[e].init();t=null},common:function(t,n){var e=this;this.name=t,this.listen=function(t,e){n.on(t,function(t,n){e.apply(n.element,[t].concat(n.args))})},n.on("execute",function(t,n){var a=[].concat(n.args),o=a.shift(),r=e[o];r&&r.apply(e,a),t.stopPropagation()}),n.on("instance",function(a,o){o.call(e,t,n)})},app:function(t,n){c.common.apply(this,arguments);var e=n.get(0);this.watch=function(t,e,a){n.on(e,t,a)},this.x=function(t){return t=n.find(t),function(){var n=o.call(arguments);t.trigger("execute",{args:n})}},this.emit=function(a,r){r=o.call(arguments),r.shift(),n.trigger(t+":"+a,{args:r,element:e})},this.publish=function(t,n){n=o.call(arguments),n.shift(),a.trigger(t,{args:n,element:e})},this.subscribe=function(t,n){a.on(t,function(t,e){n.apply(e.element,[t].concat(e.args))})}},component:function(t,n){c.common.apply(this,arguments);this.emit=function(e,a){a=o.call(arguments),a.shift(),n.trigger(t+":"+e,{args:a,element:n.get(0)})}}};return n});
