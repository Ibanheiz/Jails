define(function(){function t(t){var e="component"!=t?"app":t;return function(o,a){this instanceof n[t]?c[e].call(this,arguments[2],arguments[1]):n[t+"s"][o]=function(t,n){c[e].call(this,o,t),a.call(this,t,n)}}}var n,e,o,a,i={};a=Array.prototype.slice,n={context:null,config:{templates:{type:"x-tmpl-mustache"}},apps:{},controllers:{},components:{},templates:{},filters:{},app:t("app"),controller:t("controller"),component:t("component"),filter:function(t,n){this.filters[t]=function(){return function(t,e){return n(e(t))}}},start:function(t,a){e=t.base,n.context=e(document.documentElement),o=e("<i />"),e.extend(!0,n.config,t),r.start(a),n.context.addClass("ready")},refresh:function(t){r.start(t)},data:function(){return i},scanner:function(){return r}},n.filters.out=function(t){var n=e(t),o=e("<div />"),a=n.data("out");return n.html(new Function("return "+a)()),o.append(n),o.html()};var r={start:function(t){var e,o=[];t=t||n.context,e=n.config.templates.type,r.scan("partial","script[type="+e+"]",t,o),r.scan("component","[data-component]",t,o),r.scan("controller","[data-controller]",t,o),r.scan("app","[data-app]",t,o),c.start(o)},scan:function(t,o,a,i){a=a||n.context;var c,s,l,u;s=a.get(0).querySelectorAll(o),l=s.length;for(var p=0;l>p;p++)c=e(s[p]),u=r[t],u?u(t,c,i):r.module(t,c,i)},module:function(t,e,o){var a,r,s="s";a=e.data(t),r=n[t+s][a],r=r?new r(e,i):new c[t](a,e,t),o.push(r)},partial:function(t,o){var a=n.config.templates.prefix,i=o.prop("id").split(a||"tmpl-").pop();n.templates[i]=e.trim(o.html())},component:function(t,o,a){var i,s,l,u;i=o.data(t),u=r.annotations(i,o),s=i.replace(/\s/g,"").split(/\,/),e.each(s,function(e,i){l=n.components[i],l=l?new l(o,i in u?u[i]:{}):new c[t](i,o),a.push(l)})},annotations:function(t,n){var e,o,a={};return e=n.get(0).previousSibling,e=e?e.previousSibling:null,e&&8==e.nodeType&&(o=e.data.replace(/[\n\t]/g,"").replace(/\@([a-zA-z0-9-]*)\(([^@]*)\)/g,function(t,n,e){a[n]=new Function("return "+e)()})),a}},c={start:function(t){for(var n=t.length,e=0;n>e;e++)t[e].init&&t[e].init();t=null},common:function(t,n){var e=this;this.name=t,n.on("execute",function(t,n){var o=[].concat(n.args),a=o.shift(),i=e[a];i&&i.apply(e,o),t.stopPropagation()}),n.on("instance",function(o,a){a.call(e,t,n)})},app:function(t,n){c.common.apply(this,arguments);var e=n.get(0);this.watch=function(t,e,o){n.on(e,t,o)},this.x=function(t){return t=n.find(t),function(){var n=a.call(arguments);t.trigger("execute",{args:n})}},this.listen=function(t,e){n.on(t,function(t,n){e.apply(n.element,[t].concat(n.args))})},this.emit=function(o,i){i=a.call(arguments),i.shift(),n.trigger(t+":"+o,{args:i,element:e})},this.publish=function(t,n){n=a.call(arguments),n.shift(),o.trigger(t,{args:n,element:e})},this.subscribe=function(t,n){o.on(t,function(t,e){n.apply(e.element,[t].concat(e.args))})}},component:function(t,n){c.common.apply(this,arguments);this.emit=function(e,o){o=a.call(arguments),o.shift(),n.trigger(t+":"+e,{args:o,element:n.get(0)})},this.listen=function(t,e){n.on(t,function(t,n){e.apply(n.element,[t].concat(n.args))})}}};return n});
