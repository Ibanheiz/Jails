define(function(){function t(t){var e="component"!=t?"app":t;return function(o,a){return this instanceof n[t]?void c[e].call(this,arguments[2],arguments[1]):n[t+"s"][o]=function(t,n){c[e].call(this,o,t),a.call(this,t,n)}}}var n,e,o,a,r={};a=Array.prototype.slice,n={context:null,config:{templates:{type:"x-tmpl-mustache"}},apps:{},controllers:{},components:{},templates:{},filters:{},app:t("app"),controller:t("controller"),component:t("component"),filter:function(t,n){this.filters[t]=function(){return function(t,e){return n(e(t))}}},start:function(t,a){e=t.base,n.context=e(document.documentElement),o=e("<i />"),e.extend(!0,n.config,t),i.start(a),n.context.addClass("ready")},refresh:function(t){i.start(t)},data:function(){return r},scanner:function(){return i}},n.filters.out=function(t){var n=e(t),o=e("<div />"),a=n.data("out");return n.html(new Function("return "+a)()),o.append(n),o.html()};var i={start:function(t){var e,o=[];t=t||n.context,e=n.config.templates.type,i.scan("partial","script[type="+e+"]",t,o),i.scan("component","[data-component]",t,o),i.scan("controller","[data-controller]",t,o),i.scan("app","[data-app]",t,o),c.start(o)},scan:function(t,o,a,r){a=a||n.context;var c,s,l,u;s=a.get(0).querySelectorAll(o),l=s.length;for(var p=0;l>p;p++)c=e(s[p]),u=i[t],u?u(t,c,r):i.module(t,c,r)},module:function(t,e,o){var a,i,s="s";a=e.data(t),i=n[t+s][a],i=i?new i(e,r):new c[t](a,e,t),o.push(i)},partial:function(t,o){var a=n.config.templates.prefix,r=o.prop("id").split(a||"tmpl-").pop();n.templates[r]=e.trim(o.html())},component:function(t,o,a){var r,s,l,u;r=o.data(t),u=i.annotations(r,o),s=r.replace(/\s/g,"").split(/\,/),e.each(s,function(e,r){l=n.components[r],l=l?new l(o,r in u?u[r]:{}):new c[t](r,o),a.push(l)})},annotations:function(t,n){var e,o,a={};return e=n.get(0).previousSibling,e=e?e.previousSibling:null,e&&8==e.nodeType&&(o=e.data.replace(/[\n\t]/g,"").replace(/\@([a-zA-z0-9-]*)\(([^@]*)\)/g,function(t,n,e){a[n]=new Function("return "+e)()})),a}},c={start:function(t){for(var n=t.length,e=0;n>e;e++)t[e].init&&t[e].init();t=null},common:function(t,n){var e=this;this.name=t,this.listen=function(t,e){n.on(t,function(t,n){e.apply(n.element,[t].concat(n.args))})},n.on("execute",function(t,n){var o=[].concat(n.args),a=o.shift(),r=e[a];r&&r.apply(e,o),t.stopPropagation()}),n.on("instance",function(o,a){a.call(e,t,n)})},app:function(t,n){c.common.apply(this,arguments);var e=n.get(0);this.watch=function(t,e,o){n.on(e,t,o)},this.x=function(t){return t=n.find(t),function(){var n=a.call(arguments);t.trigger("execute",{args:n})}},this.emit=function(o,r){r=a.call(arguments),r.shift(),n.trigger(t+":"+o,{args:r,element:e})},this.publish=function(t,n){n=a.call(arguments),n.shift(),o.trigger(t,{args:n,element:e})},this.subscribe=function(t,n){o.on(t,function(t,e){n.apply(e.element,[t].concat(e.args))})}},component:function(t,n){c.common.apply(this,arguments);this.emit=function(e,o){o=a.call(arguments),o.shift(),n.trigger(t+":"+e,{args:o,element:n.get(0)})}}};return n});
