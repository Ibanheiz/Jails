define(function(){function u(e){function t(e){var t;e.trigger("get-instance",function(e){t=e});return t||{}}return{execute:function(n,r){r=Array.prototype.slice.call(arguments);r.shift();var i=t(e.eq(0));if(i[n])i[n].apply(i,r)},broadcast:function(r,i){i=Array.prototype.slice.call(arguments);i.shift();e.each(function(){var e=t(n(this));if(e[r])e[r].apply(e,i)})},instance:function(){return t(e.eq(0))}}}var e,t,n,r,i={};e={config:{templates:{type:"x-tmpl-mustache"}},context:null,start:function(t,i){n=t.base;e.context=n(document.documentElement);r=n("<i />");n.extend(true,e.config,t);s.start(i)},refresh:function(e){s.start(e)}};var s={start:function(t){var n,r=[];t=t||e.context;n=e.config.templates.type;s.scan("partial","script[type="+n+"]",t,r);s.scan("component","[data-component]",t,r);s.scan("view","[data-view]",t,r);s.scan("controller","[data-controller]",t,r);s.scan("app","[data-app]",t,r);o.start(r)},scan:function(t,r,i,o){i=i||e.context;var u,a,f,l;a=i.get(0).querySelectorAll(r);f=a.length;for(var c=0;c<f;c++){u=n(a[c]);l=s[t];l?l(t,u,o):s.module(t,u,o)}},module:function(t,n,r){var s,u,a,f="s";s=n.data(t);u=new o[t]._class(s,n,t);a=e[t+f][s];a?a.apply(u,[n,i]):null;r.push(u)},partial:function(t,r){var i=e.config.templates.prefix;var s=r.prop("id").split(i||"tmpl-").pop();e.templates[s]=n.trim(r.html())},component:function(t,r,i){var s,u,a,f;s=r.data(t);u=s.replace(/\s/g,"").split(/\,/);n.each(u,function(n,s){a=new o[t]._class(s,r);f=e.components[s];f?f.apply(a,[r]):null;i.push(a)})}};var o={start:function(e){var t=e.length;for(var n=0;n<t;n++)if(e[n].init)e[n].init();e=null},common:{_class:function(e,t){var s=this;this.name=e;t.on("get-instance",function(e,t){t(s);e.stopPropagation()});this.get=function(e,n){var r;if(n)r=t.find("[data-"+e+'*="'+n+'"]');else r=t.find("[data-"+e+"]");return u(r)};this.data=function(e){return e?i=e:i};this.watch=function(e,n,r){t.on(n,e,r)};this.broadcast=function(e,t){n(e).trigger(t)};this.listen=function(e,t){r.on(e,function(e,n){t.apply(n.element,[e].concat(n.args))})};this.emit=function(n,i){i=Array.prototype.slice.call(arguments);i.shift();r.trigger(e+":"+n,{args:i,element:t.get(0)})}}},app:{_class:function(e,t){o.common._class.apply(this,[e,t])}},controller:{_class:function(e,t){o.common._class.apply(this,[e,t])}},view:{_class:function(t,n){function l(e){return u[e]}o.common._class.apply(this,[t,n]);var r,i,u,a,f=this;r=n.data("template");a=n.data("render");i=e.config.templates;u=e.templates;this.template=function(e,t){return i.engine.render(l(t),e,u)};this.render=function(e,t){r=t||r;if(r&&u[r])this.partial(n,r,e)};this.partial=function(e,t,n){if(u[t]){var r=i.engine.render(l(t),n,u);e.html(r);s.start(e)}};a?this.render({}):null}},model:{_class:function(e,t){var n,r=this;this.name=e;this.on_update=function(){};this.data=function(e,t){if(e){n=e;if(t)this.transform(t,e);this.on_update(n)}else return n};this.size=function(){var e=0;for(var t in n)e++;return e};this.find=function(e){return n[e]};this.remove=function(e){delete n[e];this.on_update(n)};this.update=function(e,t){n[e]=t;this.on_update(n)};this.transform=function(e,t){t=t||n;t=t.push?t:[t];var r={},i=t.length,s,o;for(s=0;s<i;s++){o=t[s];r[o[e||s]]=o}count=s;n=r}}},component:{_class:function(e,t){this.name=e;var n=this;t.on("get-instance",function(e,t){t(n);e.stopPropagation()});this.emit=function(n,r){r=Array.prototype.slice.call(arguments);r.shift();t.trigger(e+":"+n,{args:r,element:t.get(0)})}}}};var a={_class:function(){this.apps={};this.controllers={};this.views={};this.models={};this.components={};this.templates={};this.controller=function(e,t){this.controllers[e]=t},this.component=function(e,t){this.components[e]=t},this.view=function(e,t){this.views[e]=t},this.app=function(e,t){this.apps[e]=t},this.model=function(t,n){e.models[t]=n;var r=new o.model._class(t);n.apply(r);return r}}};a._class.apply(e);return e})
