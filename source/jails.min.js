define(function(){function t(t){var e="component"!=t?"app":t;return function(a,o){this instanceof n[t]?r[e].call(this,arguments[2],arguments[1]):n[t+"s"][a]=function(t,n){r[e].call(this,a,t),o.call(this,t,n)}}}var n,e,a,o,i={};o=Array.prototype.slice,n={context:null,config:{templates:{type:"x-tmpl-mustache"}},apps:{},controllers:{},components:{},templates:{},filters:{},app:t("app"),controller:t("controller"),component:t("component"),filter:function(t,n){this.filters[t]=function(){return function(t,e){return n(e(t))}}},start:function(t,o){e=t.base,n.context=e(document.documentElement),a=e("<i />"),e.extend(!0,n.config,t),c.start(o),n.context.addClass("ready")},refresh:function(t){c.start(t)},data:function(){return i},scanner:function(){return c}},n.filters.out=function(t){var n=e(t),a=e("<div />"),o=n.data("out");return n.html(new Function("return "+o)()),a.append(n),a.html()};var c={start:function(t){var e,a=[];t=t||n.context,e=n.config.templates.type,c.scan("partial","script[type="+e+"]",t,a),c.scan("component","[data-component]",t,a),c.scan("controller","[data-controller]",t,a),c.scan("app","[data-app]",t,a),r.start(a)},scan:function(t,a,o,i){o=o||n.context;var r,s,l,u;s=o.get(0).querySelectorAll(a),l=s.length;for(var p=0;l>p;p++)r=e(s[p]),u=c[t],u?u(t,r,i):c.module(t,r,i)},module:function(t,e,a){var o,c,s="s";o=e.data(t),c=n[t+s][o],c=c?new c(e,i):new r[t]._class(o,e,t),a.push(c)},partial:function(t,a){var o=n.config.templates.prefix,i=a.prop("id").split(o||"tmpl-").pop();n.templates[i]=e.trim(a.html())},component:function(t,a,o){var i,s,l,u;i=a.data(t),u=c.annotations(i,a),s=i.replace(/\s/g,"").split(/\,/),e.each(s,function(e,i){l=n.components[i],l=l?new l(a,i in u?u[i]:{}):new r[t]._class(i,a),o.push(l)})},annotations:function(t,n){var e,a,o={};return e=n.get(0).previousSibling,e=e?e.previousSibling:null,e&&8==e.nodeType&&(a=e.data.replace(/[\n\s\t]/g,"").replace(/\@(\w*)\(([^@]*)\)/g,function(t,n,e){o[n]=new Function("return "+e)()})),o}},r={start:function(t){for(var n=t.length,e=0;n>e;e++)t[e].init&&t[e].init();t=null},common:function(t,n){var e=this;this.name=t,n.on("execute",function(t,n){var a=[].concat(n.args),o=a.shift(),i=e[o];i&&i.apply(e,a),t.stopPropagation()}),n.on("instance",function(a,o){o.call(e,t,n)})},app:function(t,n){r.common.apply(this,arguments);var e=n.get(0);this.watch=function(t,e,a){n.on(e,t,a)},this.x=function(t){return t=n.find(t),function(){var n=o.call(arguments);t.trigger("execute",{args:n})}},this.listen=function(t,e){n.on(t,function(t,n){e.apply(n.element,[t].concat(n.args))})},this.emit=function(a,i){i=o.call(arguments),i.shift(),n.trigger(t+":"+a,{args:i,element:e})},this.publish=function(t,n){n=o.call(arguments),n.shift(),a.trigger(t,{args:n,element:e})},this.subscribe=function(t,n){a.on(t,function(t,e){n.apply(e.element,[t].concat(e.args))})}},component:function(t,n){r.common.apply(this,arguments);this.emit=function(e,a){a=o.call(arguments),a.shift(),n.trigger(t+":"+e,{args:a,element:n.get(0)})},this.listen=function(t,e){n.on(t,function(t,n){e.apply(n.element,[t].concat(n.args))})}}};return n});
